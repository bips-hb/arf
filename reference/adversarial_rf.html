<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Adversarial Random Forests — adversarial_rf • arf</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Adversarial Random Forests — adversarial_rf"><meta name="description" content="Implements an adversarial random forest to learn independence-inducing splits."><meta property="og:description" content="Implements an adversarial random forest to learn independence-inducing splits."><meta property="og:image" content="https://bips-hb.github.io/arf/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">arf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/arf.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bips-hb/arf/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Adversarial Random Forests</h1>
      <small class="dont-index">Source: <a href="https://github.com/bips-hb/arf/blob/main/R/adversarial_rf.R" class="external-link"><code>R/adversarial_rf.R</code></a></small>
      <div class="d-none name"><code>adversarial_rf.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Implements an adversarial random forest to learn independence-inducing splits.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">adversarial_rf</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  num_trees <span class="op">=</span> <span class="fl">10L</span>,</span>
<span>  min_node_size <span class="op">=</span> <span class="fl">2L</span>,</span>
<span>  delta <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  max_iters <span class="op">=</span> <span class="fl">10L</span>,</span>
<span>  early_stop <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  prune <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>Input data. Integer variables are recoded as ordered factors with
a warning. See Details.</p></dd>


<dt id="arg-num-trees">num_trees<a class="anchor" aria-label="anchor" href="#arg-num-trees"></a></dt>
<dd><p>Number of trees to grow in each forest. The default works
well for most generative modeling tasks, but should be increased for
likelihood estimation. See Details.</p></dd>


<dt id="arg-min-node-size">min_node_size<a class="anchor" aria-label="anchor" href="#arg-min-node-size"></a></dt>
<dd><p>Minimal number of real data samples in leaf nodes.</p></dd>


<dt id="arg-delta">delta<a class="anchor" aria-label="anchor" href="#arg-delta"></a></dt>
<dd><p>Tolerance parameter. Algorithm converges when OOB accuracy is
&lt; 0.5 + <code>delta</code>.</p></dd>


<dt id="arg-max-iters">max_iters<a class="anchor" aria-label="anchor" href="#arg-max-iters"></a></dt>
<dd><p>Maximum iterations for the adversarial loop.</p></dd>


<dt id="arg-early-stop">early_stop<a class="anchor" aria-label="anchor" href="#arg-early-stop"></a></dt>
<dd><p>Terminate loop if performance fails to improve from one
round to the next?</p></dd>


<dt id="arg-prune">prune<a class="anchor" aria-label="anchor" href="#arg-prune"></a></dt>
<dd><p>Impose <code>min_node_size</code> by pruning?</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Print discriminator accuracy after each round?</p></dd>


<dt id="arg-parallel">parallel<a class="anchor" aria-label="anchor" href="#arg-parallel"></a></dt>
<dd><p>Compute in parallel? Must register backend beforehand, e.g.
via <code>doParallel</code> or <code>doFuture</code>; see examples.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Extra parameters to be passed to <code>ranger</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A random forest object of class <code>ranger</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The adversarial random forest (ARF) algorithm partitions data into fully
factorized leaves where features are jointly independent. ARFs are trained
iteratively, with alternating rounds of generation and discrimination. In
the first instance, synthetic data is generated via independent bootstraps of
each feature, and a RF classifier is trained to distinguish between real and
fake samples. In subsequent rounds, synthetic data is generated separately in
each leaf, using splits from the previous forest. This creates increasingly
realistic data that satisfies local independence by construction. The
algorithm converges when a RF cannot reliably distinguish between the two
classes, i.e. when OOB accuracy falls below 0.5 + <code>delta</code>.</p>
<p>ARFs are useful for several unsupervised learning tasks, such as density
estimation (see <code><a href="forde.html">forde</a></code>) and data synthesis (see
<code><a href="forge.html">forge</a></code>). For the former, we recommend increasing the number of
trees for improved performance (typically on the order of 100-1000 depending
on sample size).</p>
<p>Integer variables are recoded with a warning. Default behavior is to convert
those with six or more unique values to numeric, while those with up to five
unique values are treated as ordered factors. To override this behavior,
explicitly recode integer variables to the target type prior to training.</p>
<p>Note: convergence is not guaranteed in finite samples. The <code>max_iters</code>
argument sets an upper bound on the number of training rounds. Similar
results may be attained by increasing <code>delta</code>. Even a single round can
often give good performance, but data with strong or complex dependencies may
require more iterations. With the default <code>early_stop = TRUE</code>, the
adversarial loop terminates if performance does not improve from one round
to the next, in which case further training may be pointless.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Watson, D., Blesch, K., Kapar, J., &amp; Wright, M. (2023). Adversarial random
forests for density estimation and generative modeling. In <em>Proceedings
of the 26th International Conference on Artificial Intelligence and
Statistics</em>, pp. 5357-5375.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="arf-package.html">arf</a></code>, <code><a href="forde.html">forde</a></code>, <code><a href="forge.html">forge</a></code>, <code><a href="expct.html">expct</a></code>, <code><a href="lik.html">lik</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Train ARF and estimate leaf parameters</span></span></span>
<span class="r-in"><span><span class="va">arf</span> <span class="op">&lt;-</span> <span class="fu">adversarial_rf</span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Iteration: 0, Accuracy: 70.71%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Iteration: 1, Accuracy: 45.95%</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>executing %dopar% sequentially: no parallel backend registered</span>
<span class="r-in"><span><span class="va">psi</span> <span class="op">&lt;-</span> <span class="fu"><a href="forde.html">forde</a></span><span class="op">(</span><span class="va">arf</span>, <span class="va">iris</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Generate 100 synthetic samples from the iris dataset</span></span></span>
<span class="r-in"><span><span class="va">x_synth</span> <span class="op">&lt;-</span> <span class="fu"><a href="forge.html">forge</a></span><span class="op">(</span><span class="va">psi</span>, n_synth <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Condition on Species = "setosa" and Sepal.Length &gt; 6</span></span></span>
<span class="r-in"><span><span class="va">evi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Species <span class="op">=</span> <span class="st">"setosa"</span>,</span></span>
<span class="r-in"><span>                  Sepal.Length <span class="op">=</span> <span class="st">"(6, Inf)"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x_synth</span> <span class="op">&lt;-</span> <span class="fu"><a href="forge.html">forge</a></span><span class="op">(</span><span class="va">psi</span>, n_synth <span class="op">=</span> <span class="fl">100</span>, evidence <span class="op">=</span> <span class="va">evi</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Estimate average log-likelihood</span></span></span>
<span class="r-in"><span><span class="va">ll</span> <span class="op">&lt;-</span> <span class="fu"><a href="lik.html">lik</a></span><span class="op">(</span><span class="va">psi</span>, <span class="va">iris</span>, arf <span class="op">=</span> <span class="va">arf</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ll</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -0.4833021</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Expectation of Sepal.Length for class setosa</span></span></span>
<span class="r-in"><span><span class="va">evi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Species <span class="op">=</span> <span class="st">"setosa"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="expct.html">expct</a></span><span class="op">(</span><span class="va">psi</span>, query <span class="op">=</span> <span class="st">"Sepal.Length"</span>, evidence <span class="op">=</span> <span class="va">evi</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Sepal.Length</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1      5.01668</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Parallelization with doParallel</span></span></span>
<span class="r-in"><span><span class="fu">doParallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/doParallel/man/registerDoParallel.html" class="external-link">registerDoParallel</a></span><span class="op">(</span>cores <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ... or with doFuture</span></span></span>
<span class="r-in"><span><span class="fu">doFuture</span><span class="fu">::</span><span class="fu"><a href="https://doFuture.futureverse.org/reference/registerDoFuture.html" class="external-link">registerDoFuture</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="st">"multisession"</span>, workers <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Marvin N. Wright, David S. Watson, Kristin Blesch, Jan Kapar.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

